FROM debian:10

RUN apt-get update
RUN apt-get install -y xz-utils build-essential

ARG BUILD=release
RUN set -ex; \
  if [ "$BUILD" = "debug" ]; then \
		apt-get install -y strace procps elfutils gdb binutils vim patchelf jq; \
	fi

COPY fastfreeze.tar.xz /tmp

RUN set -ex; \
  tar xf /tmp/fastfreeze.tar.xz -C /opt; \
  ln -s /opt/fastfreeze/fastfreeze /usr/local/bin/

WORKDIR /opt/fastfreeze

COPY tests/apps test_apps
RUN make -C test_apps
